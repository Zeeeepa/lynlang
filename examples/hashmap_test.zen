// Test HashMap implementation
{ HashMap } = @std.collections
{ Allocator } = @std.memory.allocator

test_hashmap = () i32 {
    alloc = Allocator.system()

    // Create new HashMap<i32, i32>
    map = HashMap<i32, i32>.new(alloc)
    map_mut = map.mut_ref()

    // Insert some values
    map_mut.insert(1, 100)
    map_mut.insert(2, 200)
    map_mut.insert(3, 300)

    // Test get
    val1 = map.get(1)
    val1 ?
        | Some(v) {
            v == 100 ?
                | true { }
                | false { return 1 }  // FAIL: wrong value
        }
        | None { return 2 }  // FAIL: key not found

    // Test contains_key
    has_key = map.contains_key(2)
    has_key ?
        | true { }
        | false { return 3 }  // FAIL: should contain key 2

    // Test remove
    removed = map_mut.remove(2)
    removed ?
        | Some(v) {
            v == 200 ?
                | true { }
                | false { return 4 }  // FAIL: wrong removed value
        }
        | None { return 5 }  // FAIL: should have removed key

    // Verify key was removed
    has_key2 = map.contains_key(2)
    has_key2 ?
        | true { return 6 }  // FAIL: key should be removed
        | false { }

    // Clean up
    map_mut.free()

    return 0  // SUCCESS
}

main = () i32 {
    result = test_hashmap()
    return result
}
