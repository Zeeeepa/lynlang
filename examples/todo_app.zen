// Todo App - Complete Application Example
{ io, time } = @std

// Core Types
Priority: High, Medium, Low

Todo: {
    id: i32,
    text: string,
    priority: Priority,
    done: bool,
    created: i64
}

TodoList: {
    items: DynVec<Todo>,
    next_id: i32
}

// Priority methods
Priority.icon = (self) string {
    self ? | High { "ğŸ”´" } | Medium { "ğŸŸ¡" } | Low { "ğŸŸ¢" }
}

Priority.sort_value = (self) i32 {
    self ? | High { 3 } | Medium { 2 } | Low { 1 }
}

// Todo methods

Todo.display = (self) string {
    check = self.done ? | true { "âœ…" } | false { "â¬œ" }
    "${check} [${self.id}] ${self.priority.icon()} ${self.text}"
}

TodoList.new = () TodoList {
    TodoList { items: DynVec<Todo>{}, next_id: 1 }
}

TodoList.add = (self, text: string, priority: Priority) void {
    self.items.push(Todo {
        id: self.next_id,
        text: text,
        priority: priority,
        done: false,
        created: time.now()
    })
    self.next_id += 1
}

TodoList.complete = (self, id: i32) void {
    self.items
        .find_index((t) => t.id == id)
        .map((i) => { self.items[i].done = true })
}

TodoList.active = (self) []Todo {
    self.items
        .filter((t) => !t.done)
        .sort((a, b) => b.priority.sort_value() - a.priority.sort_value())
}

TodoList.show_active = (self) void {
    active = self.active()
    active.empty() ?
        | true { io.println("  No active todos!") }
        | false { active.loop((t) => io.println("  ${t.display()}")) }
}

TodoList.stats = (self) string {
    total = self.items.len()
    done = self.items.filter((t) => t.done).len()
    "ğŸ“Š Total: ${total} | Done: ${done} | Active: ${total - done}"
}

// Main Application
main = () void {
    io.println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    io.println("â•‘  TODO APP  â•‘")
    io.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•\n")
    
    todos = TodoList.new()
    
    // Add tasks
    todos.add("Write documentation", Priority.High)
    todos.add("Fix bug in parser", Priority.High)
    todos.add("Refactor lexer", Priority.Medium)
    todos.add("Update README", Priority.Low)
    todos.add("Review PRs", Priority.Medium)
    
    io.println("â–¸ Active Todos:")
    todos.show_active()
    
    io.println("\nâ–¸ Completing tasks...")
    todos.complete(2)
    todos.complete(4)
    
    io.println("\nâ–¸ Updated List:")
    todos.show_active()
    
    io.println("\n${todos.stats()}")
}