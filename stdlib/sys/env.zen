// Zen Standard Library: Environment (Syscall-based)
// No FFI - uses compiler.syscall* intrinsics

{ compiler } = @std
{ Result } = @std.core.result

SYS_GETCWD = 79
SYS_CHDIR = 80
SYS_GETPID = 39
SYS_GETPPID = 110

EnvError: { code: i32 }
EnvError.from_errno = (errno: i64) EnvError { return EnvError { code: (0 - errno) as i32 } }

// Get current working directory into buffer
getcwd = (buf: Ptr<u8>, size: usize) Result<usize, EnvError> {
    result = compiler.syscall2(SYS_GETCWD, compiler.ptr_to_int(buf), size)
    result < 0 ? { return Result.Err(EnvError.from_errno(result)) }
    return Result.Ok(result as usize)
}

// Change current working directory
chdir = (path_ptr: i64) Result<(), EnvError> {
    result = compiler.syscall1(SYS_CHDIR, path_ptr)
    result < 0 ? { return Result.Err(EnvError.from_errno(result)) }
    return Result.Ok(())
}

// Get process ID
getpid = () i32 {
    return compiler.syscall0(SYS_GETPID) as i32
}

// Get parent process ID
getppid = () i32 {
    return compiler.syscall0(SYS_GETPPID) as i32
}
