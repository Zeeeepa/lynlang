// Test @this.defer() functionality
{ io } = @std

cleanup = () void {
    io.println("Cleaning up!")
}

main = () void {
    io.println("Starting main")
    
    // Register cleanup to run at function exit
    @this.defer(cleanup())
    
    io.println("Doing work...")
    io.println("More work...")
    
    // cleanup() should run automatically after this
    io.println("Ending main")
}