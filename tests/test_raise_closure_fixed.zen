// Test raise() with closures returning Result<T,E> - fixed version
{ io, Result , get_default_allocator} = @std

main = () i32 {
    alloc = get_default_allocator()
    // Test 1: Basic closure returning Result<i32, StaticString>
    get_value = () Result<i32, StaticString> {
        return Result.Ok(42)
    }
    
    val1 = get_value().raise()
    val1 == 42 ?
        | true { io.println("✓ Test 1: Basic closure with Result<i32, StaticString>") }
        | false { 
            io.println("✗ Test 1 failed: Expected 42, got ${val1}")
        }
    
    // Test 2: Closure with parameters returning Result<f64, StaticString>
    divide = (a: f64, b: f64) Result<f64, StaticString> {
        b == 0.0 ?
            | true { return Result.Err("Division by zero") }
            | false { return Result.Ok(a / b) }
    }
    
    val2 = divide(10.0, 2.0).raise()
    val2 == 5.0 ?
        | true { io.println("✓ Test 2: Closure with params returning Result<f64, StaticString>") }
        | false {
            io.println("✗ Test 2 failed: Expected 5.0, got ${val2}")
        }
    
    // Test 3: Inline closure with raise
    inline_fn = () Result<i32, StaticString> { return Result.Ok(100) }
    val3 = inline_fn().raise()
    val3 == 100 ?
        | true { io.println("✓ Test 3: Inline closure with raise") }
        | false {
            io.println("✗ Test 3 failed: Expected 100, got ${val3}")
        }
    
    // Test 4: Closure with computation
    compute = () Result<i32, StaticString> {
        return Result.Ok(50 * 2)
    }
    
    val4 = compute().raise()
    val4 == 100 ?
        | true { io.println("✓ Test 4: Closure with computation") }
        | false {
            io.println("✗ Test 4 failed: Expected 100, got ${val4}")
        }
    
    // Test 5: Nested closures with raise
    outer = () Result<i32, StaticString> {
        inner = () Result<i32, StaticString> {
            return Result.Ok(25)
        }
        val = inner().raise()
        return Result.Ok(val * 2)
    }
    
    val5 = outer().raise()
    val5 == 50 ?
        | true { io.println("✓ Test 5: Nested closures with raise") }
        | false {
            io.println("✗ Test 5 failed: Expected 50, got ${val5}")
        }
    
    io.println("\n✓ All closure + raise() tests passed!")
    return 0
}