// Test HashMap with proper allocator usage
{ io, get_default_allocator, HashMap } = @std

// Simple hash function for testing
hash_string = (s: string) i64 {
    hash ::= 0
    i ::= 0
    loop {
        i >= s.len() ? { break }
        c = s.char_at(i)
        hash = hash * 31 + (c as i64)
        i = i + 1
    }
    return hash
}

// String equality function  
eq_string = (a: string, b: string) i64 {
    a == b ?
        | true { return 1 }
        | false { return 0 }
}

main = () i32 {
    // Get default allocator
    alloc = get_default_allocator()
    
    // Create HashMap with allocator
    map = HashMap<string, i32>(alloc)
    
    // Insert some values
    map.insert("hello", 42, hash_string, eq_string)
    map.insert("world", 100, hash_string, eq_string)
    map.insert("zen", 999, hash_string, eq_string)
    
    // Get values
    val1 = map.get("hello", hash_string, eq_string)
    val1 ?
        | Some(v) { io.print_int(v) }  // Should print 42
        | None { io.println("Key not found") }
    
    io.println("")
    
    val2 = map.get("world", hash_string, eq_string)
    val2 ?
        | Some(v) { io.print_int(v) }  // Should print 100
        | None { io.println("Key not found") }
    
    io.println("")
    
    val3 = map.get("zen", hash_string, eq_string)
    val3 ?
        | Some(v) { io.print_int(v) }  // Should print 999
        | None { io.println("Key not found") }
    
    io.println("")
    
    // Test non-existent key
    val4 = map.get("missing", hash_string, eq_string)
    val4 ?
        | Some(v) { io.print_int(v) }
        | None { io.println("Key not found") }  // Should print this
    
    // Test length
    io.print_int(map.len())  // Should print 3
    io.println("")
    
    return 0
}