// Simplest possible test for nested Result issue
{ io, Result } = @std

main = () i32 {
    // This should create:
    // 1. 42 heap-allocated at addr A
    // 2. Inner Result struct {tag=0, ptr=A} 
    // 3. Inner struct heap-allocated at addr B
    // 4. Outer Result struct {tag=0, ptr=B}
    nested = Result.Ok(Result.Ok(42))
    
    // When we extract, we should get:
    // 1. Outer extracts ptr=B
    // 2. Load from B gives inner struct {tag=0, ptr=A}
    // 3. Inner extracts ptr=A
    // 4. Load from A gives 42
    
    nested ?
        | Result.Ok(inner) {
            inner ?
                | Result.Ok(value) {
                    io.println("Got value: ${value}")
                    io.println("Value is 42? ${value == 42}")
                    value == 42 ? | true => 0 | false => 1
                }
                | Result.Err(e) => 2
        }
        | Result.Err(e) => 3
}