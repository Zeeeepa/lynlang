// Debug nested payload extraction issue
{ io, Result, Option } = @std

main = () i32 {
    io.println("=== Testing Nested Payload Extraction ===")
    
    // Step 1: Create simple Result
    simple = Result.Ok(42)
    simple ?
        | Result.Ok(v) { io.println("Simple Result: ${v}") }
        | Result.Err(e) { io.println("Error: ${e}") }
    
    // Step 2: Create nested Result
    nested = Result.Ok(Result.Ok(42))
    io.println("\n--- Nested Result created ---")
    
    // Step 3: Extract outer payload
    nested ?
        | Result.Ok(inner) {
            io.println("Got outer Result.Ok")
            
            // Step 4: Extract inner payload
            inner ?
                | Result.Ok(val) {
                    io.println("Got inner Result.Ok with value: ${val}")
                    val == 42 ?
                        | true { 
                            io.println("✓ Value is correct (42)")
                            return 0
                        }
                        | false { 
                            io.println("✗ Value is wrong (expected 42, got ${val})")
                            return 1
                        }
                }
                | Result.Err(e) { 
                    io.println("Inner Result.Err: ${e}")
                    return 2
                }
        }
        | Result.Err(e) { 
            io.println("Outer Result.Err: ${e}")
            return 3
        }
}
